#!/usr/bin/env sh
opt="$1"; shift;
case "$opt" in
    tidy)
        fmt="markdown_github-hard_line_breaks+yaml_metadata_block+tex_math_dollars+line_blocks"
        pandoc -s --atx-headers -t $fmt --wrap=None --reference-links "$1" -o "$1" ;;
    tidynoref)
        fmt="markdown_github-hard_line_breaks+yaml_metadata_block+tex_math_dollars+line_blocks"
        pandoc -s --atx-headers -t $fmt --wrap=None "$1" -o "$1" ;;
    pdf)
        outfn="$1"
        title="$2"
        pandoc "${@:3:$#}" -o "$outfn" --toc --toc-depth=2 -V title="$title" -V documentclass=report -V geometry:margin=1in ;;
    html)
        fn=.$(extractFilenameNoExt "$1").html
        [ -e "$fn" ] && rm "$fn"
        pandoc -s -c ~/.dotfiles/github-markdown.css --self-contained --mathjax "$1" > "$fn" ;;
    preview) echo "davison markdown preview - Not implemented" ;;
    *)
        base=$(basename "$0")
        echo "usage: $base markdown tidy|tidynoref|pdf|html|preview" 
        echo ""
        echo "    tidy: no hard line breaks, reference links, math"
        echo "    tidynoref: no hard line breaks, math"
        echo "    pdf: pdf with table of contents, standalone, narrow margin"
        echo "    html: "
        ;;
esac
